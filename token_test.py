from langchain_core.messages import HumanMessage
import os
from langchain_openai import AzureChatOpenAI

from dotenv import load_dotenv
load_dotenv("LangGraph/.env")

# # 測試的 max_tokens 值
# max_tokens_to_test = [4096, 8192, 16384]

# for max_tokens in max_tokens_to_test:
#     print(f"\n=== 測試 max_tokens={max_tokens} ===")
#     llm = AzureChatOpenAI(
#                     deployment_name="gpt-4o",
#                     openai_api_version="2024-08-01-preview",
#                     # azure_endpoint=os.getenv('AZURE_OPENAI_ENDPOINT'),
#                     openai_api_key=os.getenv('AZURE_OPENAI_API_KEY'),
#                     max_tokens=max_tokens,
#                 )
#     prompt = "請產生一段超長的亂數文字或長篇英文 Lorem Ipsum（長度超過 %d 個 token），只要純文字不要說明。" % max_tokens

#     try:
#         response = llm.invoke([HumanMessage(content=prompt)])
#         text = response.content if hasattr(response, "content") else response
#         print(f"回傳字數: {len(text)}")
#         print(f"前200字: {text[:200]} ...")
#         print(f"後200字: {text[-200:]}")
#         print(f"---- 測試結束，請檢查內容有無被截斷 ----")
#     except Exception as e:
#         print(f"錯誤：{e}")

import tiktoken

card_str = '''{"$schema":"http://adaptivecards.io/schemas/adaptive-card.json","type":"AdaptiveCard","version":"1.0","body":[{"type":"ColumnSet","columns":[{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"Date","weight":"bolder","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"erp_id","weight":"bolder","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"Customer Name","weight":"bolder","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"PO No","weight":"bolder","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"Part","weight":"bolder","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"US Amount","weight":"bolder","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"Qty","weight":"bolder","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"Unit Price","weight":"bolder","wrap":true}]}]},{"type":"ColumnSet","columns":[{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"2024-05-20","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"T84177591","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"圳泰企業有限公司","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"TWO142106","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"EI-52-BTO","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"0.0","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"1.0","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"0.0","wrap":true}]}]},{"type":"ColumnSet","columns":[{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"2024-05-20","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"T84177591","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"圳泰企業有限公司","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"TWO142106","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"EI-52-S6A1","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"981.59","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"1.0","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"981.59","wrap":true}]}]},{"type":"ColumnSet","columns":[{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"2024-05-20","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"T84177591","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"圳泰企業有限公司","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"TWO142106","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"SQR-SD4N16G3K2SNCB","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"44.02","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"1.0","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"44.02","wrap":true}]}]},{"type":"ColumnSet","columns":[{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"2024-05-20","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"T84177591","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"圳泰企業有限公司","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"TWO142106","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"EWM-W193H01E","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"22.05","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"1.0","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"22.05","wrap":true}]}]},{"type":"ColumnSet","columns":[{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"2024-05-20","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"T84177591","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"圳泰企業有限公司","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"TWO142106","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"1750007965-01","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"5.87","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"2.0","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"2.935","wrap":true}]}]},{"type":"ColumnSet","columns":[{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"2024-05-20","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"T84177591","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"圳泰企業有限公司","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"TWO142106","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"1750008717-01","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"6.05","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"2.0","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"3.025","wrap":true}]}]},{"type":"ColumnSet","columns":[{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"2024-05-20","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"T84177591","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"圳泰企業有限公司","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"TWO142106","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"9656EWMG00E","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"3.33","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"1.0","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"3.33","wrap":true}]}]},{"type":"ColumnSet","columns":[{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"2024-05-20","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"T84177591","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"圳泰企業有限公司","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"TWO142106","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"20706WX9VM0021","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"63.32","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"1.0","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"63.32","wrap":true}]}]},{"type":"ColumnSet","columns":[{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"2024-05-20","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"T84177591","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"圳泰企業有限公司","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"TWO142106","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"1700001524","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"2.16","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"1.0","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"2.16","wrap":true}]}]},{"type":"ColumnSet","columns":[{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"2024-05-20","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"T84177591","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"圳泰企業有限公司","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"TWO142106","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"AGS-CTOS-SYS-A","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"23.19","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"1.0","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"23.19","wrap":true}]}]},{"type":"ColumnSet","columns":[{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"2024-05-20","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"T84177591","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"圳泰企業有限公司","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"TWO142106","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"SQF-SLMV2-256GDSDC","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"39.38","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"1.0","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"39.38","wrap":true}]}]},{"type":"ColumnSet","columns":[{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"2024-05-20","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"T84177591","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"圳泰企業有限公司","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"TWO142106","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"EI-52-BTO","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"0.0","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"3.0","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"0.0","wrap":true}]}]},{"type":"ColumnSet","columns":[{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"2024-05-20","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"T84177591","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"圳泰企業有限公司","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"TWO142106","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"EI-52-S6A1","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"2902.92","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"3.0","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"967.64","wrap":true}]}]},{"type":"ColumnSet","columns":[{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"2024-05-20","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"T84177591","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"圳泰企業有限公司","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"TWO142106","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"SQR-SD4N16G3K2SNCB","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"132.06","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"3.0","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"44.02","wrap":true}]}]},{"type":"ColumnSet","columns":[{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"2024-05-20","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"T84177591","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"圳泰企業有限公司","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"TWO142106","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"96FD80-P256-TS","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"160.0","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"3.0","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"53.333333333333336","wrap":true}]}]},{"type":"ColumnSet","columns":[{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"2024-05-20","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"T84177591","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"圳泰企業有限公司","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"TWO142106","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"EWM-W193H01E","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"66.17","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"3.0","wrap":true}]},{"type":"Column","width":"stretch","items":[{"type":"TextBlock","text":"22.05666666666667","wrap":true}]}]},{"type":"ColumnSet","columns":[{"type":"Column","width":"stretch","'''

enc = tiktoken.encoding_for_model("gpt-4o")
tokens = enc.encode(card_str)
print("Token count:", len(tokens))
